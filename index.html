<!DOCTYPE html>
<html>
<head>
<title>Migrants: where did your friends move to?</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="css/style.css" type="text/css">
<link rel="icon" type="image/png" href="world.png" />
<script type="text/javascript"
    src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCUf-MblhWb4oUjoyyRtzYmCcBYpEJhhQc&sensor=false">
</script>
<script type="text/javascript">
  var plotter;

  function initialize() {
    var center = new google.maps.LatLng(43.012924, 0.0);
	
	var darkMapStyles = [
	  {
	    featureType: "administrative",
	    stylers: [
	      { visibility: "off" }
	    ]
	  },{
	    featureType: "poi",
	    stylers: [
	      { visibility: "off" }
	    ]
	  },{
	    featureType: "road",
	    stylers: [
	      { visibility: "off" }
	    ]
	  },{
	    featureType: "transit",
	    stylers: [
	      { visibility: "off" }
	    ]
	  },{
	    featureType: "landscape",
	    stylers: [
	      { visibility: "simplified" },
	      { hue: "#00b2ff" },
	      { saturation: 80 },
	      { lightness: 4 },
	      { invert_lightness: true }
	    ]
	  },{
	    featureType: "water",
	    stylers: [
	      { visibility: "simplified" },
	      { invert_lightness: true },
	      { saturation: 59 },
	      { lightness: -18 },
	      { hue: "#00c3ff" }
	    ]
	  },{
	  }
	];
	

    var myOptions = {
		center: center,
        zoom: 2,
        minZoom: 2,
        mapTypeId: google.maps.MapTypeId.TERRAIN,
		panControl: false,
        zoomControl: false,
        mapTypeControl: false,
        scaleControl: false,
        streetViewControl: false,
        overviewMapControl: false,
		mapTypeId: 'DefconMap'
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"),
        myOptions);

	var darkMapType = new google.maps.StyledMapType(darkMapStyles, {
	        name: 'Name'
	    });
	map.mapTypes.set('DefconMap', darkMapType);

	plotter = new Plotter(map);
  }

</script>
</head>
<body>
	<body onload="initialize()">
	  <div id="map_canvas" style="width:100%; height:100%"></div>
	</body>
	<div id="fb-root"></div>
	
	<div id="controls">
	<!-- this should be drawn in an overlay or something similar -->
	<div class="fb-login-button" data-show-faces="true" data-width="200"
		data-max-rows="2"
		perms="user_location,friends_location,user_hometown,friends_hometown"></div>
	</div>

	<script type="text/javascript" src="scripts/plotData.js"></script>
	<script type="text/javascript" src="scripts/gatherData.js"></script>
	
	<script>
		window.fbAsyncInit = function() {
			FB.init({
				appId : '127670657334000',
				status : true, // check login status
				cookie : true, // enable cookies to allow the server to access the session
				xfbml : true, // parse XFBML
				channelUrl : 'http://migrants.abahgat.com/channel.html', // Custom Channel URL
				oauth : true
			//enables OAuth 2.0
			});

			FB.getLoginStatus(function(response) {
				if (response.authResponse) {
					// logged in and connected user, someone you know
					console.log("logged in");
					
					// TODO this should be called whenever we learn who the current user is
					document.getElementById('controls').style.display = 'none';
					var collector = new DataCollector();
					var data = collector.collect(plotter);
					
				} else {
					// no user session available, someone you dont know
					console.log("not logged in");
					document.getElementById('controls').style.display = 'block';
				}
			});

		};

		(function() {
			var e = document.createElement('script');
			//e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
			e.src = 'http://connect.facebook.net/en_US/all.js';

			e.async = true;
			document.getElementById('fb-root').appendChild(e);
		}());
	</script>



</body>
</html>
